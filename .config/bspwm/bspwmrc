#!/usr/bin/env bash

bspc rule -r "*";


##### Autostart {{{
  # Kep Modmap
  xmodmap ~/.config/sxhkd/.Xmodmap &

  # Key daemon
  killall -9 sxhkd;
  sxhkd &

  # Compositor
  killall -9 compton;
  compton --config ~/compton.conf &

  # Notification manager
  killall -9 dunst;
  dunst -config ~/.config/dunst/dunstrc &

  # Status bar
  killall -9 polybar;
  polybar primary &

  # Wallpaper
  ~/.fehbg &

  # Network manager applet
  killall -9 nm-applet;
  nm-applet &

  # Load up the xresources file
  xrdb ~/.Xresources &

  # Transmission torrent client
  # transmission-daemon --download-dir "$HOME/Downloads/dl" &
# }}}



##### Workspace/Monitor config {{{
  bspc monitor -d 1 2 3 4 5 6 7 8 9 10

  # Reassign_monitor
  #   If has secondary monitor
  #     Then assign workspace Primary = 1-5, Secondary = 6-10
  #     Else assign workspace Primary 1-10
  # Reassign monitor
  # On monitor {add,remove}
  #   Reassign monitor (by name)
  #   Swap old monitor workspaces into new

  bspc config remove_disabled_monitors    true
  bspc config remove_unplugged_monitors   true
  bspc config merge_overlapping_monitors  true
# }}}



##### UI config {{{
  bspc config presel_feedback_color	"#00d080"

  bspc config border_width         0
  bspc config window_gap           12

  bspc config pointer_modifier  lock
  bspc config pointer_action1   move
  bspc config pointer_action2   resize_side
  bspc config pointer_action3   resize_corner
  bspc config click_to_focus    any
# }}}



##### Layouts config {{{
  bspc config automatic_scheme  alternate # alternate|spiral|longest_side
  bspc config initial_polarity  second_child

  bspc config split_ratio          0.6

  bspc config single_monocle       true
  bspc config borderless_monocle   true
  bspc config gapless_monocle      true
# }}}



##### Node rules {{{
  # Rules to be enabled only on bsp initialization
  enable-init-rules() {
    bspc rule -a "Brave-browser" -o desktop="6";
  }

  bspc config external_rules_command "$HOME/.config/bspwm/external_rules"
# }}}



##### Initialized applications {{{
  window_count=$(bspc query -N | wc -l);

  if [[ "$window_count" = "0" ]]; then
    enable-init-rules;
    browser &
    spotify &
  fi
# }}}

disown;
